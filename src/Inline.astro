---
import { Gutter, getSafeGutter, BaseTheme, CSSLength } from '@chisel-ui/core'
import { InlineClusterProps } from '@chisel-ui/inline-cluster/astro'
import '@chisel-ui/inline-cluster/css'
import './Inline.css'

export interface InlineProps extends InlineClusterProps {
    stretch?: 'all' | 'start' | 'end' | number
    switchAt?: CSSLength | number
}

function shouldUseSwitch(switchAt?: CSSLength | number) {
    if (switchAt && switchAt > -1) {
        return true
    }

    if (typeof switchAt === 'string' && typeof CSS !== undefined) {
        return CSS.supports(`height: ${switchAt}`)
    }

    return false
}

const justifyMap = {
    start: 'flex-start',
    end: 'flex-end',
    center: 'center'
}

const alignMap = {
    ...justifyMap,
    stretch: 'stretch'
}

const { justify = 'start', align = 'start', gutter = '0px', theme = {}, as: Tag = 'div', stretch, switchAt } = Astro.props as InlineProps

const maybeGutter = getSafeGutter(theme, gutter)
const maybeJustify = justifyMap[justify] || justifyMap.start
const maybeAlign = alignMap[align] || alignMap.start
const maybeSwithcAt = shouldUseSwitch(switchAt)
    ? typeof switchAt === 'string'
        ? switchAt
        : `${switchAt}px`
    : undefined
---

<Tag data-chisel-inline data-chisel-inline-cluster style={`--gutter: ${maybeGutter}; --justify: ${maybeJustify}; --align: ${maybeAlign}; --switchAt: ${maybeSwithcAt};`} data-stretch={typeof stretch === 'string' && stretch} data-stretch-child={typeof stretch === 'number' && stretch}>
    <slot />
</Tag>
